{
  "title": "Echo Notify",
  "panels": [
    {
      "type": "timeseries",
      "title": "Send Total",
      "targets": [
        {
          "expr": "sum(echo_notify_send_total)"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Send Total by Type",
      "targets": [
        {
          "expr": "sum by (type) (echo_notify_send_total{outcome=\"success\"})"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Retry Total",
      "targets": [
        {
          "expr": "sum(echo_notify_retry_total)"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Retry Total by Type",
      "targets": [
        {
          "expr": "sum by (type) (echo_notify_retry_total)"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "DLQ Total",
      "targets": [
        {
          "expr": "sum(echo_notify_dlq_total)"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "DLQ by Error Category",
      "targets": [
        {
          "expr": "sum by (error_category) (echo_notify_dlq_total)"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Error Total by Category",
      "targets": [
        {
          "expr": "sum by (error_category) (echo_notify_error_total)"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Send Latency P95 by Type",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le, type) (rate(echo_notify_send_latency_seconds_bucket[5m])))"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "SLO Target (P95 <= 2s)",
      "targets": [
        {
          "expr": "2"
        },
        {
          "expr": "max(histogram_quantile(0.95, sum by (le, type) (rate(echo_notify_send_latency_seconds_bucket[5m]))))"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "P95 SLO Breach Ratio (5m)",
      "targets": [
        {
          "expr": "max(histogram_quantile(0.95, sum by (le, type) (rate(echo_notify_send_latency_seconds_bucket[5m])))) / 2"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Consumer Group Lag",
      "targets": [
        {
          "expr": "kafka_consumergroup_lag"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Records Lag Max",
      "targets": [
        {
          "expr": "kafka_consumer_fetch_manager_records_lag_max"
        }
      ]
    }
  ],
  "schemaVersion": 39,
  "version": 1
}
